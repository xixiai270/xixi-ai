<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#9333EA">
  <title>xixi.ai - AI Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
    }
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: manipulation;
    }
    #root {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // Lucide Icons
    const Send = ({ className }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
      </svg>
    );

    const Trash2 = ({ className }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const MessageSquare = ({ className }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    );

    const Plus = ({ className }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Sparkles = ({ className }) => (
      <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
        <path d="M5 3v4"></path>
        <path d="M19 17v4"></path>
        <path d="M3 5h4"></path>
        <path d="M17 19h4"></path>
      </svg>
    );

    function XixiAI() {
      const [messages, setMessages] = useState([]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const [currentPage, setCurrentPage] = useState('chat');
      const [conversations, setConversations] = useState([]);
      const [currentConvId, setCurrentConvId] = useState(null);
      const [showImageGen, setShowImageGen] = useState(false);
      const [imagePrompt, setImagePrompt] = useState('');
      const [generatingImage, setGeneratingImage] = useState(false);
      const [level, setLevel] = useState(1);
      const [xp, setXp] = useState(0);
      const [showLevelUp, setShowLevelUp] = useState(false);
      const messagesEndRef = useRef(null);

      const xpToNextLevel = level * 100;
      const xpProgress = (xp / xpToNextLevel) * 100;

      useEffect(() => {
        loadConversations();
        loadProgress();
      }, []);

      const loadProgress = async () => {
        try {
          const saved = localStorage.getItem('user-progress');
          if (saved) {
            const progress = JSON.parse(saved);
            setLevel(progress.level || 1);
            setXp(progress.xp || 0);
          }
        } catch (error) {
          console.log('No saved progress');
        }
      };

      const saveProgress = (newXp, newLevel) => {
        try {
          localStorage.setItem('user-progress', JSON.stringify({
            level: newLevel,
            xp: newXp,
            timestamp: Date.now()
          }));
        } catch (error) {
          console.error('Error saving progress:', error);
        }
      };

      const addXp = (amount) => {
        const newXp = xp + amount;
        const neededXp = level * 100;
        
        if (newXp >= neededXp) {
          const newLevel = level + 1;
          const remainingXp = newXp - neededXp;
          setLevel(newLevel);
          setXp(remainingXp);
          setShowLevelUp(true);
          setTimeout(() => setShowLevelUp(false), 3000);
          saveProgress(remainingXp, newLevel);
        } else {
          setXp(newXp);
          saveProgress(newXp, level);
        }
      };

      const loadConversations = () => {
        try {
          const saved = localStorage.getItem('conversations');
          if (saved) {
            setConversations(JSON.parse(saved));
          }
        } catch (error) {
          console.log('No previous conversations');
        }
      };

      const saveConversation = () => {
        if (messages.length === 0) return;
        
        const convId = currentConvId || Date.now().toString();
        const conv = {
          id: convId,
          messages,
          timestamp: Date.now(),
          preview: messages[0]?.content.slice(0, 50) || 'New chat'
        };
        
        try {
          const allConvs = [...conversations.filter(c => c.id !== convId), conv].sort((a, b) => b.timestamp - a.timestamp);
          localStorage.setItem('conversations', JSON.stringify(allConvs));
          setConversations(allConvs);
          setCurrentConvId(convId);
        } catch (error) {
          console.error('Error saving conversation:', error);
        }
      };

      const loadConversation = (conv) => {
        setMessages(conv.messages);
        setCurrentConvId(conv.id);
        setCurrentPage('chat');
      };

      const newChat = () => {
        setMessages([]);
        setCurrentConvId(null);
        setCurrentPage('chat');
      };

      const deleteConversation = (convId) => {
        try {
          const filtered = conversations.filter(c => c.id !== convId);
          localStorage.setItem('conversations', JSON.stringify(filtered));
          setConversations(filtered);
          if (currentConvId === convId) {
            newChat();
          }
        } catch (error) {
          console.error('Error deleting conversation:', error);
        }
      };

      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
      };

      useEffect(() => {
        scrollToBottom();
      }, [messages]);

      useEffect(() => {
        if (messages.length > 0) {
          saveConversation();
        }
      }, [messages]);

      const sendMessage = async () => {
        if (!input.trim() || loading) return;

        const userMessage = { role: 'user', content: input };
        setMessages(prev => [...prev, userMessage]);
        const userInput = input.toLowerCase();
        setInput('');
        setLoading(true);

        // Simulate AI thinking
        await new Promise(resolve => setTimeout(resolve, 800));

        try {
          let aiResponse = generateResponse(userInput);

          const assistantMessage = {
            role: 'assistant',
            content: aiResponse
          };
          
          setMessages(prev => [...prev, assistantMessage]);
          addXp(25);
        } catch (error) {
          console.error('Error:', error);
        } finally {
          setLoading(false);
        }
      };

      const generateResponse = (input) => {
        // Greetings
        if (input.match(/^(salut|bonjour|hello|hi|hey|coucou)/)) {
          const greetings = [
            "Salut ! ðŸ‘‹ Comment puis-je t'aider aujourd'hui ?",
            "Hey ! Je suis lÃ  pour toi, qu'est-ce que tu veux savoir ? ðŸ˜Š",
            "Bonjour ! PrÃªt Ã  discuter ? Pose-moi tes questions ! âœ¨"
          ];
          return greetings[Math.floor(Math.random() * greetings.length)];
        }

        // Questions about the AI
        if (input.match(/(qui es tu|c'est quoi|tu es qui|what are you)/)) {
          return "Je suis xixi.ai, ton assistant IA personnel ! ðŸ» Je suis lÃ  pour rÃ©pondre Ã  tes questions, discuter de tout et mÃªme gÃ©nÃ©rer des images. Qu'est-ce qui t'intÃ©resse ? âœ¨";
        }

        // How are you
        if (input.match(/(comment vas tu|Ã§a va|how are you)/)) {
          return "Je vais super bien, merci ! ðŸ˜Š Et toi ? Qu'est-ce que je peux faire pour toi aujourd'hui ?";
        }

        // Help/capabilities
        if (input.match(/(aide|help|que peux tu faire|capacitÃ©s)/)) {
          return "Je peux faire plein de choses ! ðŸš€\n\nâ€¢ RÃ©pondre Ã  tes questions\nâ€¢ Discuter de sujets variÃ©s\nâ€¢ T'aider avec des conseils\nâ€¢ GÃ©nÃ©rer des images (clique sur 'Image')\nâ€¢ Gagner de l'XP ensemble ! ðŸŽ®\n\nPose-moi n'importe quelle question !";
        }

        // Code/programming
        if (input.match(/(code|programmer|dÃ©velopp|python|javascript|html)/)) {
          return "Je peux t'aider avec la programmation ! ðŸ’» Que veux-tu savoir ? Des bases d'un langage, comment rÃ©soudre un bug, ou crÃ©er quelque chose de spÃ©cifique ? Dis-moi tout !";
        }

        // Math
        if (input.match(/(\d+\s*[\+\-\*\/]\s*\d+)/)) {
          try {
            const result = eval(input.match(/(\d+\s*[\+\-\*\/]\s*\d+)/)[0]);
            return `Le rÃ©sultat est : **${result}** ðŸ”¢`;
          } catch {
            return "Je peux t'aider avec les maths ! Donne-moi une opÃ©ration claire (ex: 25 + 17) ðŸ§®";
          }
        }

        // Motivation
        if (input.match(/(motivat|encourag|triste|dÃ©prim|down)/)) {
          const motivations = [
            "Tu es capable de grandes choses ! ðŸ’ª Chaque petit pas compte, continue d'avancer ! âœ¨",
            "Hey, je crois en toi ! ðŸŒŸ Les moments difficiles sont temporaires, ta force est permanente !",
            "Tu gÃ¨res ! ðŸ”¥ N'oublie pas tout le chemin que tu as dÃ©jÃ  parcouru. Continue comme Ã§a ! ðŸš€"
          ];
          return motivations[Math.floor(Math.random() * motivations.length)];
        }

        // Weather (can't access real data)
        if (input.match(/(mÃ©tÃ©o|weather|temps|tempÃ©rature)/)) {
          return "Je ne peux pas accÃ©der aux donnÃ©es mÃ©tÃ©o en temps rÃ©el, mais tu peux vÃ©rifier sur weather.com ou ton app mÃ©tÃ©o ! â˜€ï¸ðŸŒ§ï¸";
        }

        // Time/Date
        if (input.match(/(heure|date|jour|time|today)/)) {
          const now = new Date();
          return `Nous sommes le ${now.toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })} et il est ${now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })} ! â°`;
        }

        // Jokes
        if (input.match(/(blague|joke|rire|drÃ´le)/)) {
          const jokes = [
            "Pourquoi les plongeurs plongent-ils toujours en arriÃ¨re ? Parce que sinon ils tombent dans le bateau ! ðŸ˜„",
            "Qu'est-ce qu'un crocodile qui surveille une caserne ? Un Lacoste garde ! ðŸŠ",
            "Pourquoi les poissons n'aiment pas jouer au tennis ? Parce qu'ils ont peur du filet ! ðŸŽ¾"
          ];
          return jokes[Math.floor(Math.random() * jokes.length)];
        }

        // Music
        if (input.match(/(musique|music|chanson|song|spotify)/)) {
          return "J'adore parler de musique ! ðŸŽµ Quel genre tu Ã©coutes ? Hip-hop, rock, pop, Ã©lectro ? Dis-moi tes artistes prÃ©fÃ©rÃ©s ! ðŸŽ§";
        }

        // Games
        if (input.match(/(jeu|game|gaming|jouer|console)/)) {
          return "Les jeux vidÃ©o c'est gÃ©nial ! ðŸŽ® Tu joues sur quelle plateforme ? PC, console, mobile ? Parle-moi de tes jeux prÃ©fÃ©rÃ©s ! ðŸ•¹ï¸";
        }

        // Food
        if (input.match(/(manger|food|cuisine|recette|restaurant)/)) {
          return "Mmmh, la nourriture ! ðŸ• Tu veux des idÃ©es de recettes, des recommandations de restaurants, ou juste discuter de bouffe ? Je suis lÃ  ! ðŸ˜‹";
        }

        // Sports
        if (input.match(/(sport|football|basket|nba|tennis)/)) {
          return "Tu aimes le sport ! âš½ Parle-moi de ton Ã©quipe prÃ©fÃ©rÃ©e ou de ce qui t'intÃ©resse dans le sport ! ðŸ€";
        }

        // Movies/Series
        if (input.match(/(film|sÃ©rie|movie|netflix|cinema)/)) {
          return "Le cinÃ©ma et les sÃ©ries, j'adore Ã§a ! ðŸŽ¬ Qu'est-ce que tu regardes en ce moment ? Tu veux des recommandations ? ðŸ¿";
        }

        // Travel
        if (input.match(/(voyage|travel|pays|vacances|trip)/)) {
          return "Les voyages c'est incroyable ! âœˆï¸ Tu as visitÃ© des endroits cool rÃ©cemment ? Ou tu planifies un voyage ? Raconte-moi ! ðŸ—ºï¸";
        }

        // School/Studies
        if (input.match(/(Ã©cole|Ã©tud|school|devoir|cours|exam)/)) {
          return "Je peux t'aider avec tes Ã©tudes ! ðŸ“š Quelle matiÃ¨re ? Math, sciences, langues, histoire ? Pose-moi tes questions ! ðŸŽ“";
        }

        // Technology
        if (input.match(/(tech|technologie|ordi|iphone|android|smartphone)/)) {
          return "La tech, c'est passionnant ! ðŸ“±ðŸ’» Tu veux parler de quel sujet tech ? Apps, gadgets, IA, nouveautÃ©s ? Je suis lÃ  ! âš¡";
        }

        // Love/Relationships
        if (input.match(/(amour|relation|crush|copain|copine)/)) {
          return "Les relations c'est compliquÃ© parfois ! ðŸ’• Je peux pas remplacer un vrai conseil d'ami, mais je peux t'Ã©couter ! Raconte-moi ce qui se passe. ðŸ˜Š";
        }

        // Thank you
        if (input.match(/(merci|thanks|thank you)/)) {
          return "De rien ! ðŸ˜Š C'est toujours un plaisir de t'aider ! N'hÃ©site pas si tu as d'autres questions ! âœ¨";
        }

        // Goodbye
        if (input.match(/(au revoir|bye|goodbye|salut|ciao)/)) {
          return "Ã€ plus tard ! ðŸ‘‹ Reviens quand tu veux, je serai lÃ  ! âœ¨";
        }

        // Default intelligent response
        const responses = [
          `IntÃ©ressant ! "${input}" me fait penser Ã  plein de choses. Tu peux m'en dire plus ? ðŸ¤”`,
          `J'ai bien compris ta question sur "${input.substring(0, 30)}...". C'est un sujet fascinant ! Qu'est-ce qui t'intÃ©resse prÃ©cisÃ©ment ? ðŸ’¡`,
          `Super question ! Pour "${input.substring(0, 30)}...", je dirais qu'il y a plusieurs angles Ã  considÃ©rer. Tu veux qu'on explore lequel ? ðŸŽ¯`,
          `Ah, tu parles de "${input.substring(0, 30)}..." ! C'est cool comme sujet. Qu'est-ce que tu veux savoir exactement ? ðŸš€`,
          `Je comprends ta question ! "${input.substring(0, 30)}..." mÃ©rite une vraie discussion. Pose-moi une question plus prÃ©cise et je te rÃ©ponds en dÃ©tail ! ðŸ˜Š`
        ];
        
        return responses[Math.floor(Math.random() * responses.length)];
      };

      const generateImage = async () => {
        if (!imagePrompt.trim() || generatingImage) return;

        const userMessage = { role: 'user', content: `[Image]: ${imagePrompt}`, type: 'image-request' };
        setMessages(prev => [...prev, userMessage]);
        const prompt = imagePrompt;
        setImagePrompt('');
        setGeneratingImage(true);

        try {
          // Simple SVG generation based on keywords
          const keywords = prompt.toLowerCase();
          let svg = '';
          
          if (keywords.includes('sunset') || keywords.includes('coucher de soleil')) {
            svg = `<svg width="400" height="300" viewBox="0 0 400 300"><rect fill="#FF6B35" width="400" height="300"/><circle cx="200" cy="150" r="80" fill="#FFD700"/><rect y="200" fill="#FF8C42" width="400" height="100"/></svg>`;
          } else if (keywords.includes('mountain') || keywords.includes('montagne')) {
            svg = `<svg width="400" height="300" viewBox="0 0 400 300"><rect fill="#87CEEB" width="400" height="300"/><polygon points="100,250 200,100 300,250" fill="#8B7355"/><polygon points="200,250 300,120 400,250" fill="#A0826D"/></svg>`;
          } else if (keywords.includes('ocean') || keywords.includes('mer')) {
            svg = `<svg width="400" height="300" viewBox="0 0 400 300"><rect fill="#0EA5E9" width="400" height="300"/><path d="M0,150 Q100,120 200,150 T400,150 L400,300 L0,300" fill="#0284C7"/><circle cx="350" cy="50" r="30" fill="#FDE047"/></svg>`;
          } else {
            svg = `<svg width="400" height="300" viewBox="0 0 400 300"><defs><linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#9333EA"/><stop offset="100%" style="stop-color:#EC4899"/></linearGradient></defs><rect fill="url(#grad)" width="400" height="300"/><text x="200" y="150" text-anchor="middle" fill="white" font-size="24" font-weight="bold">${prompt}</text></svg>`;
          }
          
          setMessages(prev => [...prev, {
            role: 'assistant',
            content: svg,
            type: 'image'
          }]);
          
          addXp(50);
        } catch (error) {
          console.error('Error:', error);
          setMessages(prev => [...prev, {
            role: 'assistant',
            content: "Erreur lors de la gÃ©nÃ©ration. ðŸ˜•"
          }]);
        } finally {
          setGeneratingImage(false);
        }
      };

      const clearChat = () => {
        setMessages([]);
        setCurrentConvId(null);
      };

      if (currentPage === 'history') {
        return (
          <div className="h-screen w-full bg-gradient-to-br from-purple-600 via-pink-400 to-orange-300 overflow-hidden flex flex-col relative">
            <div className="absolute inset-0 overflow-hidden opacity-20">
              <div className="absolute top-20 left-10 w-40 h-40 border-4 border-white transform rotate-45"></div>
              <div className="absolute bottom-40 right-20 w-60 h-60 rounded-full border-4 border-white"></div>
            </div>

            <div className="px-4 py-4 bg-white/90 backdrop-blur-sm border-b-4 border-purple-600 relative z-10">
              <div className="flex items-center justify-between max-w-4xl mx-auto">
                <h1 className="text-xl sm:text-2xl font-black text-purple-900">Conversations</h1>
                <button
                  onClick={newChat}
                  className="px-3 sm:px-4 py-2 rounded-xl bg-gradient-to-r from-purple-600 to-pink-500 text-white font-bold hover:shadow-lg transition-all flex items-center gap-2 text-sm"
                >
                  <Plus className="w-4 h-4" />
                  <span className="hidden sm:inline">New</span>
                </button>
              </div>
            </div>

            <div className="flex-1 overflow-y-auto px-4 py-4 relative z-10">
              {conversations.length === 0 ? (
                <div className="h-full flex flex-col items-center justify-center text-center">
                  <div className="w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-white/90 flex items-center justify-center mb-4">
                    <MessageSquare className="w-8 h-8 sm:w-10 sm:h-10 text-purple-600" />
                  </div>
                  <p className="text-white text-base sm:text-lg font-bold">No conversations yet</p>
                </div>
              ) : (
                <div className="space-y-3 max-w-4xl mx-auto">
                  {conversations.map((conv) => (
                    <div
                      key={conv.id}
                      className="bg-white/90 backdrop-blur-sm rounded-2xl p-3 sm:p-4 border-2 border-purple-300 hover:border-purple-600 hover:shadow-xl transition-all cursor-pointer"
                      onClick={() => loadConversation(conv)}
                    >
                      <div className="flex items-start justify-between gap-3">
                        <div className="flex-1 min-w-0">
                          <p className="text-gray-900 font-bold mb-1 line-clamp-2 text-xs sm:text-sm">{conv.preview}</p>
                          <span className="text-purple-600 text-xs font-semibold">
                            {new Date(conv.timestamp).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                          </span>
                        </div>
                        <button
                          onClick={(e) => {
                            e.stopPropagation();
                            deleteConversation(conv.id);
                          }}
                          className="p-2 hover:bg-red-100 rounded-lg transition-all flex-shrink-0"
                        >
                          <Trash2 className="w-4 h-4 text-gray-500 hover:text-red-600" />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            <div className="p-3 sm:p-4 bg-white/90 backdrop-blur-sm border-t-4 border-purple-600 relative z-10">
              <div className="max-w-4xl mx-auto">
                <button
                  onClick={() => setCurrentPage('chat')}
                  className="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-500 text-white rounded-xl font-bold hover:shadow-lg transition-all text-sm sm:text-base"
                >
                  Back to Chat
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="h-screen w-full bg-gradient-to-br from-purple-600 via-pink-400 to-orange-300 overflow-hidden flex flex-col relative">
          <div className="absolute inset-0 overflow-hidden opacity-20">
            <div className="absolute top-20 left-10 w-40 h-40 border-4 border-white transform rotate-45"></div>
            <div className="absolute bottom-40 right-20 w-60 h-60 rounded-full border-4 border-white"></div>
            <div className="absolute top-60 right-40 w-32 h-32 bg-yellow-300 transform rotate-12"></div>
          </div>

          <div className="px-3 sm:px-6 py-3 sm:py-5 bg-white/90 backdrop-blur-sm border-b-4 border-purple-600 relative z-10">
            <div className="flex items-center justify-between max-w-4xl mx-auto mb-2 sm:mb-3">
              <h1 className="text-2xl sm:text-3xl font-black text-purple-900">xixi.ai</h1>
              <div className="flex gap-2">
                <button
                  onClick={() => setCurrentPage('history')}
                  className="p-2 sm:p-2.5 rounded-xl bg-purple-200 hover:bg-purple-300 transition-all"
                >
                  <MessageSquare className="w-4 h-4 sm:w-5 sm:h-5 text-purple-900" />
                </button>
                <button
                  onClick={clearChat}
                  className="p-2 sm:p-2.5 rounded-xl bg-purple-200 hover:bg-purple-300 transition-all"
                >
                  <Trash2 className="w-4 h-4 sm:w-5 sm:h-5 text-purple-900" />
                </button>
              </div>
            </div>
            
            <div className="max-w-4xl mx-auto">
              <div className="flex items-center gap-2 sm:gap-3">
                <div className="flex items-center gap-1.5 sm:gap-2 bg-gradient-to-r from-purple-600 to-pink-500 px-2 sm:px-4 py-1.5 sm:py-2 rounded-xl border-2 border-purple-900 shadow-lg">
                  <span className="text-white font-black text-sm sm:text-lg">LVL {level}</span>
                </div>
                
                <div className="flex-1 relative h-6 sm:h-8 bg-gray-800 rounded-xl border-2 border-purple-900 overflow-hidden shadow-inner">
                  <div 
                    className="absolute inset-0 bg-gradient-to-r from-yellow-400 via-orange-500 to-pink-500 transition-all duration-500 ease-out"
                    style={{ width: `${xpProgress}%` }}
                  >
                    <div className="absolute inset-0 bg-gradient-to-t from-transparent to-white/30 animate-pulse"></div>
                  </div>
                  <div className="absolute inset-0 flex items-center justify-center">
                    <span className="text-white font-bold text-xs sm:text-sm drop-shadow-lg z-10">
                      {xp} / {xpToNextLevel}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {showLevelUp && (
            <div className="absolute inset-0 z-50 flex items-center justify-center pointer-events-none p-4">
              <div className="animate-bounce">
                <div className="bg-gradient-to-r from-yellow-400 via-orange-500 to-pink-500 px-6 sm:px-12 py-4 sm:py-6 rounded-3xl border-4 border-white shadow-2xl">
                  <h2 className="text-3xl sm:text-5xl font-black text-white text-center drop-shadow-lg">
                    LEVEL UP! ðŸŽ‰
                  </h2>
                  <p className="text-xl sm:text-2xl font-bold text-white text-center mt-2">
                    Niveau {level}
                  </p>
                </div>
              </div>
            </div>
          )}

          <div className="flex-1 overflow-y-auto px-3 sm:px-4 py-4 sm:py-6 relative z-10">
            <div className="max-w-4xl mx-auto">
              {messages.length === 0 && (
                <div className="h-full flex flex-col items-center justify-center text-center px-4 py-12 sm:py-20">
                  <div className="relative mb-4 sm:mb-6">
                    <svg width="120" height="120" viewBox="0 0 180 180" className="drop-shadow-2xl sm:w-auto sm:h-auto">
                      <defs>
                        <radialGradient id="glow3">
                          <stop offset="0%" stopColor="#FFD700" stopOpacity="0.5"/>
                          <stop offset="100%" stopColor="#FFD700" stopOpacity="0"/>
                        </radialGradient>
                      </defs>
                      
                      <circle cx="90" cy="95" r="75" fill="url(#glow3)"/>
                      
                      <line x1="70" y1="35" x2="70" y2="18" stroke="#000" strokeWidth="3"/>
                      <circle cx="70" cy="15" r="5" fill="#9333EA" stroke="#000" strokeWidth="2"/>
                      <circle cx="70" cy="15" r="2" fill="#fff" className="animate-pulse"/>
                      
                      <line x1="110" y1="35" x2="110" y2="18" stroke="#000" strokeWidth="3"/>
                      <circle cx="110" cy="15" r="5" fill="#EC4899" stroke="#000" strokeWidth="2"/>
                      <circle cx="110" cy="15" r="2" fill="#fff" className="animate-pulse"/>
                      
                      <circle cx="90" cy="95" r="58" fill="#fff" stroke="#000" strokeWidth="5"/>
                      <circle cx="90" cy="95" r="52" fill="#8B6F47" stroke="#000" strokeWidth="5"/>
                      
                      <circle cx="58" cy="60" r="20" fill="#8B6F47" stroke="#000" strokeWidth="4"/>
                      <circle cx="58" cy="60" r="11" fill="#D4A574" stroke="#000" strokeWidth="2"/>
                      
                      <circle cx="122" cy="60" r="20" fill="#8B6F47" stroke="#000" strokeWidth="4"/>
                      <circle cx="122" cy="60" r="11" fill="#D4A574" stroke="#000" strokeWidth="2"/>
                      
                      <ellipse cx="90" cy="108" rx="26" ry="22" fill="#D4A574" stroke="#000" strokeWidth="3"/>
                      
                      <ellipse cx="72" cy="85" rx="18" ry="22" fill="#fff" stroke="#000" strokeWidth="4"/>
                      <ellipse cx="72" cy="86" rx="15" ry="19" fill="#EC4899"/>
                      <ellipse cx="72" cy="85" rx="10" ry="13" fill="#000"/>
                      <ellipse cx="75" cy="81" rx="5" ry="7" fill="#fff"/>
                      
                      <ellipse cx="108" cy="85" rx="18" ry="22" fill="#fff" stroke="#000" strokeWidth="4"/>
                      <ellipse cx="108" cy="86" rx="15" ry="19" fill="#0EA5E9"/>
                      <ellipse cx="108" cy="85" rx="10" ry="13" fill="#000"/>
                      <ellipse cx="111" cy="81" rx="5" ry="7" fill="#fff"/>
                      
                      <ellipse cx="90" cy="105" rx="6" ry="7" fill="#000"/>
                    </svg>
                  </div>
                  <h2 className="text-2xl sm:text-4xl font-black text-white mb-2 drop-shadow-lg">
                    Start a conversation
                  </h2>
                  <p className="text-white/90 text-base sm:text-lg font-bold drop-shadow">Ask me anything</p>
                </div>
              )}
              
              {messages.map((msg, idx) => (
                <div
                  key={idx}
                  className={`mb-3 sm:mb-4 flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                >
                  <div
                    className={`max-w-[85%] px-3 sm:px-5 py-2 sm:py-3 rounded-2xl shadow-lg ${
                      msg.role === 'user'
                        ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white border-2 border-purple-400'
                        : 'bg-white/95 backdrop-blur-sm text-gray-900 border-2 border-purple-300'
                    }`}
                  >
                    {msg.type === 'image' ? (
                      <div className="w-full max-w-full overflow-hidden" dangerouslySetInnerHTML={{ __html: msg.content }} />
                    ) : (
                      <p className="text-xs sm:text-sm leading-relaxed whitespace-pre-wrap font-medium">{msg.content}</p>
                    )}
                  </div>
                </div>
              ))}
              
              {loading && (
                <div className="flex justify-start mb-4">
                  <div className="bg-white/95 backdrop-blur-sm border-2 border-purple-300 px-4 sm:px-5 py-2 sm:py-3 rounded-2xl shadow-lg">
                    <div className="flex space-x-1.5">
                      <div className="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-purple-600 rounded-full animate-bounce"></div>
                      <div className="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-pink-500 rounded-full animate-bounce" style={{animationDelay: '0.1s'}}></div>
                      <div className="w-2 h-2 sm:w-2.5 sm:h-2.5 bg-orange-500 rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                    </div>
                  </div>
                </div>
              )}
              
              <div ref={messagesEndRef} />
            </div>
          </div>

          <div className="p-3 sm:p-4 bg-white/90 backdrop-blur-sm border-t-4 border-purple-600 relative z-10">
            <div className="w-full max-w-4xl mx-auto">
              <div className="flex gap-2">
                <button
                  onClick={() => setShowImageGen(!showImageGen)}
                  className="px-3 sm:px-4 py-2.5 sm:py-3 bg-gradient-to-r from-pink-600 to-orange-500 text-white rounded-xl font-bold hover:shadow-lg transition-all flex items-center justify-center gap-1.5 sm:gap-2 flex-shrink-0"
                >
                  <Sparkles className="w-4 h-4 sm:w-5 sm:h-5" />
                  <span className="text-xs sm:text-sm">{showImageGen ? 'Chat' : 'Img'}</span>
                </button>
                
                <div className="flex gap-2 flex-1 min-w-0">
                  <input
                    type="text"
                    value={showImageGen ? imagePrompt : input}
                    onChange={(e) => showImageGen ? setImagePrompt(e.target.value) : setInput(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && (showImageGen ? generateImage() : sendMessage())}
                    placeholder={showImageGen ? "Describe..." : "Message..."}
                    className="flex-1 min-w-0 px-3 sm:px-4 py-2.5 sm:py-3 bg-white border-2 border-purple-300 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:border-purple-600 focus:ring-2 focus:ring-purple-200 transition-all text-xs sm:text-sm font-medium"
                    disabled={loading || generatingImage}
                  />
                  <button
                    onClick={showImageGen ? generateImage : sendMessage}
                    disabled={loading || generatingImage}
                    className="px-3 sm:px-5 py-2.5 sm:py-3 bg-gradient-to-r from-purple-600 to-pink-500 hover:from-purple-700 hover:to-pink-600 text-white rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg font-bold flex-shrink-0"
                  >
                    {(loading || generatingImage) ? (
                      <span className="text-xs sm:text-sm">...</span>
                    ) : (
                      showImageGen ? <Sparkles className="w-4 h-4 sm:w-5 sm:h-5" /> : <Send className="w-4 h-4 sm:w-5 sm:h-5" />
                    )}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<XixiAI />, document.getElementById('root'));
  </script>
</body>
</html>